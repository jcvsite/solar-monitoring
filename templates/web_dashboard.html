<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solar Dashboard</title>
	<link rel="manifest" href="/static/manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="SolarDash">
    <link rel="apple-touch-icon" href="/static/icons/icon-192x192.png">
	
    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.5/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@4.1.0/cdn.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0/dist/chartjs-plugin-datalabels.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <!-- Fonts & Local Stylesheet -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Carlito:wght@400;700&display=swap" rel="stylesheet">
	<link rel="icon" href="/static/icons/icon-192x192.png" type="image/png">
    <link rel="stylesheet" href="/static/css/dashboard.css">
    <script>
        // Pass backend config to the frontend
        window.WEATHER_CONFIG = JSON.parse('{{ weather_config_json | safe }}');
    </script>
</head>
<body class="light"> 
    <!-- Weather SVG ICON SPRITE -->
    <svg style="position: absolute; width: 0; height: 0;" width="0" height="0" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
        <defs><filter id="blur" width="200%" height="200%"><feGaussianBlur in="SourceAlpha" stdDeviation="3"/><feOffset dx="0" dy="4" result="offsetblur"/><feComponentTransfer><feFuncA type="linear" slope="0.05"/></feComponentTransfer><feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge></filter></defs>
        <symbol id="day" viewBox="0 0 64 64"><g filter="url(#blur)" transform="translate(32,32)"><g class="weather-sun"><g transform="rotate(0)"><line fill="none" stroke="orange" stroke-linecap="round" stroke-width="2" transform="translate(0,9)" x1="0" x2="0" y1="0" y2="3"/></g><g transform="rotate(45)"><line fill="none" stroke="orange" stroke-linecap="round" stroke-width="2" transform="translate(0,9)" x1="0" x2="0" y1="0" y2="3"/></g><g transform="rotate(90)"><line fill="none" stroke="orange" stroke-linecap="round" stroke-width="2" transform="translate(0,9)" x1="0" x2="0" y1="0" y2="3"/></g><g transform="rotate(135)"><line fill="none" stroke="orange" stroke-linecap="round" stroke-width="2" transform="translate(0,9)" x1="0" x2="0" y1="0" y2="3"/></g><g transform="rotate(180)"><line fill="none" stroke="orange" stroke-linecap="round" stroke-width="2" transform="translate(0,9)" x1="0" x2="0" y1="0" y2="3"/></g><g transform="rotate(225)"><line fill="none" stroke="orange" stroke-linecap="round" stroke-width="2" transform="translate(0,9)" x1="0" x2="0" y1="0" y2="3"/></g><g transform="rotate(270)"><line fill="none" stroke="orange" stroke-linecap="round" stroke-width="2" transform="translate(0,9)" x1="0" x2="0" y1="0" y2="3"/></g><g transform="rotate(315)"><line fill="none" stroke="orange" stroke-linecap="round" stroke-width="2" transform="translate(0,9)" x1="0" x2="0" y1="0" y2="3"/></g></g><circle cx="0" cy="0" fill="orange" r="5" stroke="orange" stroke-width="2"/></g></symbol>
        <symbol id="night" viewBox="0 0 64 64"><g filter="url(#blur)" transform="translate(20,20)"><g class="weather-moon-star-1"><polygon fill="orange" points="3.3,1.5 4,2.7 5.2,3.3 4,4 3.3,5.2 2.7,4 1.5,3.3 2.7,2.7" stroke="none" stroke-miterlimit="10"/></g><g class="weather-moon-star-2"><polygon fill="orange" points="3.3,1.5 4,2.7 5.2,3.3 4,4 3.3,5.2 2.7,4 1.5,3.3 2.7,2.7" stroke="none" stroke-miterlimit="10" transform="translate(20,10)"/></g><g class="weather-moon"><path d="M14.5,13.2c0-3.7,2-6.9,5-8.7c-1.5-0.9-3.2-1.3-5-1.3c-5.5,0-10,4.5-10,10s4.5,10,10,10c1.8,0,3.5-0.5,5-1.3C16.5,20.2,14.5,16.9,14.5,13.2z" fill="orange" stroke="orange" stroke-linejoin="round" stroke-width="2"/></g></g></symbol>
        <symbol id="cloudy" viewBox="0 0 64 64"><g filter="url(#blur)" transform="translate(20,10)"><g class="weather-cloud-2"><path d="M47.7,35.4c0-4.6-3.7-8.2-8.2-8.2c-1,0-1.9,0.2-2.8,0.5c-0.3-3.4-3.1-6.2-6.6-6.2c-3.7,0-6.7,3-6.7,6.7c0,0.8,0.2,1.6,0.4,2.3c-0.3-0.1-0.7-0.1-1-0.1c-3.7,0-6.7,3-6.7,6.7c0,3.6,2.9,6.6,6.5,6.7l17.2,0C44.2,43.3,47.7,39.8,47.7,35.4z" fill="#57A0EE" stroke="white" stroke-linejoin="round" stroke-width="1.2" transform="translate(-20,-11)"/></g></g></symbol>
        <symbol id="cloudy-day-1" viewBox="0 0 64 64"><use xlink:href="#day"/><use xlink:href="#cloudy" transform="translate(-15,0)"/></symbol>
        <symbol id="cloudy-night-1" viewBox="0 0 64 64"><use xlink:href="#night" transform="translate(-5, -5)"/><use xlink:href="#cloudy" transform="translate(-15,0)"/></symbol>
        <symbol id="rainy-6" viewBox="0 0 64 64"><use xlink:href="#cloudy"/><g transform="translate(31,46), rotate(10)"><line class="weather-rain-1" fill="none" stroke="#91C0F8" stroke-dasharray="4,4" stroke-linecap="round" stroke-width="2" transform="translate(-4,1)" x1="0" x2="0" y1="0" y2="8"/><line class="weather-rain-2" fill="none" stroke="#91C0F8" stroke-dasharray="4,4" stroke-linecap="round" stroke-width="2" transform="translate(0,-1)" x1="0" x2="0" y1="0" y2="8"/><line class="weather-rain-1" fill="none" stroke="#91C0F8" stroke-dasharray="4,4" stroke-linecap="round" stroke-width="2" transform="translate(4,0)" x1="0" x2="0" y1="0" y2="8"/></g></symbol>
        <symbol id="snowy-6" viewBox="0 0 64 64"><use xlink:href="#cloudy"/><g class="weather-snow-1"><g transform="translate(3,37)"><line fill="none" stroke="#57A0EE" stroke-linecap="round" stroke-width="1.2" transform="translate(0,9), rotate(0)" x1="0" x2="0" y1="-2.5" y2="2.5"/><line fill="none" stroke="#57A0EE" stroke-linecap="round" stroke-width="1" transform="translate(0,9), rotate(45)" x1="0" x2="0" y1="-2.5" y2="2.5"/><line fill="none" stroke="#57A0EE" stroke-linecap="round" stroke-width="1" transform="translate(0,9), rotate(90)" x1="0" x2="0" y1="-2.5" y2="2.5"/><line fill="none" stroke="#57A0EE" stroke-linecap="round" stroke-width="1" transform="translate(0,9), rotate(135)" x1="0" x2="0" y1="-2.5" y2="2.5"/></g></g><g class="weather-snow-2"><g transform="translate(11,37)"><line fill="none" stroke="#57A0EE" stroke-linecap="round" stroke-width="1.2" transform="translate(0,9), rotate(0)" x1="0" x2="0" y1="-2.5" y2="2.5"/><line fill="none" stroke="#57A0EE" stroke-linecap="round" stroke-width="1" transform="translate(0,9), rotate(45)" x1="0" x2="0" y1="-2.5" y2="2.5"/><line fill="none" stroke="#57A0EE" stroke-linecap="round" stroke-width="1" transform="translate(0,9), rotate(90)" x1="0" x2="0" y1="-2.5" y2="2.5"/><line fill="none" stroke="#57A0EE" stroke-linecap="round" stroke-width="1" transform="translate(0,9), rotate(135)" x1="0" x2="0" y1="-2.5" y2="2.5"/></g></g><g class="weather-snow-3"/></symbol>
        <symbol id="thunder" viewBox="0 0 64 64"><use xlink:href="#cloudy"/><g transform="translate(-9,28), scale(1.2)"><polygon class="weather-stroke" fill="orange" stroke="white" stroke-width="1" points="14.3,-2.9 20.5,-2.9 16.4,4.3 20.3,4.3 11.5,14.6 14.9,6.9 11.1,6.9"/></g></symbol>
        <symbol id="icon-precipitation" viewBox="0 0 24 24"><path fill="#87CEEB" d="M12 0C7.8 0 5.3 4.4 5.3 7.3c0 2.2 1.3 4.7 3.2 7.2 1.2 1.6 2.5 3.2 3.5 4.5.3.4.9.4 1.2 0 1-1.3 2.3-2.9 3.5-4.5 1.9-2.5 3.2-5 3.2-7.2C18.7 4.4 16.2 0 12 0z"/></symbol>
        <symbol id="icon-wind" viewBox="0 0 24 24"><path fill="#BDBDBD" d="M14 6h7v2h-7zm0 4h5v2h-5zm0 4h6v2h-6zM3.5 12H9v2H3.5a1.5 1.5 0 110-3H9v-2H3.5a3.5 3.5 0 100 7H9v-2H3.5a1.5 1.5 0 010-3z"/></symbol>
        <symbol id="icon-visibility" viewBox="0 0 24 24"><path fill="#BDBDBD" d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8zm11 5a5 5 0 100-10 5 5 0 000 10zm0-3a2 2 0 110-4 2 2 0 010 4z"/></symbol>
        <symbol id="icon-sunrise" viewBox="0 0 24 24"><path fill="#FFD700" d="M20 16.59V13h-2v3.59l-1.7-1.7-1.42 1.42L18.5 21l3.62-3.68-1.42-1.42L18.5 18.29zM4 16.59l2.12-2.12-1.42-1.42L1 16.71l3.62 3.68 1.42-1.42zM12 6a6 6 0 00-4.47 10.29l.7-.7a5 5 0 017.54 0l.7.7A6 6 0 0012 6zm-8 4H2v2h2zm18 0h-2v2h2z"/></symbol>
        <symbol id="pv-yield-icon" viewBox="0 0 24 24"><g fill="#FFD700"><rect x="4" y="4" width="6" height="6"/><rect x="14" y="4" width="6" height="6"/><rect x="4" y="14" width="6" height="6"/><path d="M14 20h6v-6h-6zm1-5h4v4h-4z"/><circle cx="12" cy="12" r="3" fill="#212121"/><path d="M12 9v4h2z"/></g></symbol>
    </svg>
    <button id="mqttStatus" data-tooltip="Connecting..."> MQTT <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"> <path d="M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z"/> <path d="m15 5 3 3"/> </svg> <span id="mqtt-dot" class="status-dot"></span> </button>
    <button id="themeToggle">Dark Mode</button>
    <h1> <svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="sun-icon"> <circle cx="12" cy="12" r="5"></circle> <line x1="12" y1="1" x2="12" y2="3"></line> <line x1="12" y1="21" x2="12" y2="23"></line> <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line> <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line> <line x1="1" y1="12" x2="3" y2="12"></line> <line x1="21" y1="12" x2="23" y2="12"></line> <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line> <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line> </svg> Solar Dashboard </h1>

    <div class="dashboard">
		<div class="section energy-flow-diagram-container">
            <button id="flowBoardRefreshBtn" class="flow-board-refresh-btn" title="Refresh Flow Board Data">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="23 4 23 10 17 10"></polyline>
                    <polyline points="1 20 1 14 7 14"></polyline>
                    <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
                </svg>
            </button>
            <div class="energy-flow-board">
                <div class="flow-board-content-sizer">
                    <!-- PV Groups -->
                    <div class="pv1-container pv-string-container dim">
                        <div class="pv1-border"></div>
                        <div class="pv1-name-text" id="flowBoard_pv1-name">PV 1</div>
                        <div class="pv1-watts-text" id="flowBoard_pv1-w">0 W</div>
                        <div class="pv1-volts-text" id="flowBoard_pv1-v">0 V</div>
                        <div class="pv1-amps-text" id="flowBoard_pv1-a">0 A</div>
                    </div>
                    <div class="pv2-container pv-string-container dim">
                        <div class="pv2-border"></div>
                        <div class="pv2-name-text" id="flowBoard_pv2-name">PV 2</div>
                        <div class="pv2-watts-text" id="flowBoard_pv2-w">0 W</div>
                        <div class="pv2-volts-text" id="flowBoard_pv2-v">0 V</div>
                        <div class="pv2-amps-text" id="flowBoard_pv2-a">0 A</div>
                    </div>
                    <div class="pv3-container pv-string-container dim">
                        <div class="pv3-border"></div>
                        <div class="pv3-name-text" id="flowBoard_pv3-name">PV 3</div>
                        <div class="pv3-watts-text" id="flowBoard_pv3-w">0 W</div>
                        <div class="pv3-volts-text" id="flowBoard_pv3-v">0 V</div>
                        <div class="pv3-amps-text" id="flowBoard_pv3-a">0 A</div>
                    </div>
                    <div class="pv4-container pv-string-container dim">
                        <div class="pv4-border"></div>
                        <div class="pv4-name-text" id="flowBoard_pv4-name">PV 4</div>
                        <div class="pv4-watts-text" id="flowBoard_pv4-w">0 W</div>
                        <div class="pv4-volts-text" id="flowBoard_pv4-v">0 V</div>
                        <div class="pv4-amps-text" id="flowBoard_pv4-a">0 A</div>
                    </div>
                    <!-- PV Total -->
                    <div class="pv-total-container">
                        <div class="pv-total-icon">
                            <svg viewBox="0 0 100 70" fill="none">
                                <defs> <linearGradient id="panelGradient_themed" x1="0%" y1="0%" x2="100%" y2="100%"> <stop offset="0%" class="pv-icon-panel-base-grad-stop1" /> <stop offset="100%" class="pv-icon-panel-base-grad-stop2"/> </linearGradient> </defs>
                                <g id="pv-icon-sun-animating-group"> <animateTransform attributeName="transform" type="rotate" from="0 50 25" to="360 50 25" dur="10s" repeatCount="indefinite"/> <circle cx="50" cy="25" r="16" class="pv-icon-sun-main"/> <line x1="50" y1="9" x2="50" y2="1" class="pv-icon-sun-ray"/><line x1="61.31" y1="13.69" x2="66.97" y2="8.03" class="pv-icon-sun-ray"/><line x1="66" y1="25" x2="74" y2="25" class="pv-icon-sun-ray"/><line x1="61.31" y1="36.31" x2="66.97" y2="41.97" class="pv-icon-sun-ray"/><line x1="50" y1="41" x2="50" y2="49" class="pv-icon-sun-ray"/><line x1="38.69" y1="36.31" x2="33.03" y2="41.97" class="pv-icon-sun-ray"/><line x1="34" y1="25" x2="26" y2="25" class="pv-icon-sun-ray"/><line x1="38.69" y1="13.69" x2="33.03" y2="8.03" class="pv-icon-sun-ray"/> </g>
                                <rect x="5" y="30" width="90" height="40" rx="5" ry="5" class="pv-icon-panel-base" style="stroke-width:1"/>
                                <rect x="10" y="35" width="80" height="30" class="pv-icon-panel-grid-bg" fill="none"/> <line x1="36.6" y1="35" x2="36.6" y2="65" class="pv-icon-panel-grid" style="stroke-width:0.5"/> <line x1="63.3" y1="35" x2="63.3" y2="65" class="pv-icon-panel-grid" style="stroke-width:0.5"/> <line x1="10" y1="50" x2="90" y2="50" class="pv-icon-panel-grid" style="stroke-width:0.5"/>
                                <rect id="flowBoard_pv-cell-1" class="pv-cell-glow-overlay" x="10.5" y="35.5" width="25.6" height="14" opacity="0" style="filter: none; pointer-events: none;"/> <rect id="flowBoard_pv-cell-2" class="pv-cell-glow-overlay" x="37.1" y="35.5" width="25.6" height="14" opacity="0" style="filter: none; pointer-events: none;"/> <rect id="flowBoard_pv-cell-3" class="pv-cell-glow-overlay" x="63.8" y="35.5" width="25.6" height="14" opacity="0" style="filter: none; pointer-events: none;"/> <rect id="flowBoard_pv-cell-4" class="pv-cell-glow-overlay" x="10.5" y="50.5" width="25.6" height="14" opacity="0" style="filter: none; pointer-events: none;"/> <rect id="flowBoard_pv-cell-5" class="pv-cell-glow-overlay" x="37.1" y="50.5" width="25.6" height="14" opacity="0" style="filter: none; pointer-events: none;"/> <rect id="flowBoard_pv-cell-6" class="pv-cell-glow-overlay" x="63.8" y="50.5" width="25.6" height="14" opacity="0" style="filter: none; pointer-events: none;"/>
                            </svg>
                        </div>
                        <div class="pv-total-border"></div> <div class="pv-total-watts-text" id="flowBoard_pv-total-w">0 W</div> <div class="pv-total-percent-text" id="flowBoard_pv-total-percent">0.0%</div> <div class="pv-total-kwh-text" id="flowBoard_pv-total-kwh">0.0 kWh</div>
                    </div>
					<!-- Grid -->
                    <div class="grid-container">
                        <div class="grid-icon"> <svg viewBox="0 0 64 64" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"> <defs><linearGradient id="energyGradient_themed" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" class="grid-energy-line-grad-stop1"/><stop offset="100%" class="grid-energy-line-grad-stop2"/></linearGradient></defs> <path class="grid-tower-path" d="M32 60 V34" /> <path class="grid-tower-path" d="M20 34 H44" /> <path class="grid-tower-path" d="M16 26 H48" /> <path class="grid-tower-path" d="M12 18 H52" /> <path class="energy-line" d="M32 34 L8 8" /> <path class="energy-line" d="M32 34 L56 8" /> <path class="grid-tower-path" d="M18 8 H46" /> <path class="grid-tower-path" d="M18 8 L20 4" /> <path class="grid-tower-path" d="M46 8 L44 4" /> <style>.energy-line { stroke-width: 2; stroke-dasharray: 6, 6; animation: flowBoard_flow 1.2s linear infinite, flowBoard_glow 2s ease-in-out infinite; } @keyframes flowBoard_flow { 0% { stroke-dashoffset: 0; } 100% { stroke-dashoffset: 12; } } @keyframes flowBoard_glow { 0%, 100% { filter: drop-shadow(0 0 2px var(--flow-grid-icon-energy-line-start)); } 50% { filter: drop-shadow(0 0 6px var(--flow-grid-icon-energy-line-start)); } }</style> </svg> </div>
                        <div class="grid-kwh-up-text" id="flowBoard_grid-kwh-up-value">↑0 kWh</div> <div class="grid-kwh-down-text" id="flowBoard_grid-kwh-down-value">↓0 kWh</div> <div class="grid-no-grid-text" id="flowBoard_no-grid-text">No Grid</div>
                    </div>
                    <div class="grid-power-container"> <div class="grid-power-border" id="flowBoard_grid-power-border"></div> <div class="grid-power-text" id="flowBoard_grid-power-text">0 W</div> </div>
                    <!-- Inverter -->
                    <div class="inverter-container">
                        <div class="inverter-border"></div>
                        <div class="inverter-logo"> <svg viewBox="0 0 100 35"><rect width="100" height="35" rx="5"/><text id="flowBoard_inverter-brand-text" x="5" y="55%" dominant-baseline="middle" text-anchor="start" font-family="Carlito, Arial, sans-serif" font-weight="regular" font-size="30" fill="#F57C00">Inverter</text></svg> </div>
                        <div class="inverter-fault-1" id="flowBoard_fault-light-1"></div> <div class="inverter-fault-2" id="flowBoard_fault-light-2"></div> <div class="inverter-fault-3" id="flowBoard_fault-light-3"></div> <div class="inverter-fault-4" id="flowBoard_fault-light-4" title="Inverter Plugin Status"></div>
                        <div class="inverter-fan-icon"> <span id="flowBoard_inverterFanWrapper" title="FAN: Status Unknown"> <svg viewBox="0 0 100 100" fill="none"> <defs><linearGradient id="fanBladeGradient_themed" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" class="fan-blade-grad-stop1" /><stop offset="100%" class="fan-blade-grad-stop2" /></linearGradient></defs> <circle cx="50" cy="50" r="40" class="fan-case-fill fan-case-stroke" style="stroke-width:4"/> <path id="fanBlade1" d="M 50 50 L 80 40 Q 85 45 75 50 L 80 60 Q 85 55 50 50 Z" class="fan-center-fill"><animateTransform attributeName="transform" type="rotate" from="0 50 50" to="360 50 50" dur="0.5s" repeatCount="indefinite"/></path> <path id="fanBlade2" d="M 50 50 L 80 40 Q 85 45 75 50 L 80 60 Q 85 55 50 50 Z" class="fan-center-fill" transform="rotate(120, 50, 50)"><animateTransform attributeName="transform" type="rotate" from="120 50 50" to="480 50 50" dur="0.5s" repeatCount="indefinite"/></path> <path id="fanBlade3" d="M 50 50 L 80 40 Q 85 45 75 50 L 80 60 Q 85 55 50 50 Z" class="fan-center-fill" transform="rotate(240, 50, 50)"><animateTransform attributeName="transform" type="rotate" from="240 50 50" to="600 50 50" dur="0.5s" repeatCount="indefinite"/></path> <circle cx="50" cy="50" r="12" class="fan-center-fill"/><circle cx="50" cy="50" r="42" fill="none" class="fan-outer-ring-stroke" style="stroke-width:2" stroke-dasharray="5 5"/> </svg> </span> </div>
                        <div class="inverter-temp-text" id="flowBoard_inverter-temp">0.0 °C</div> <div class="inverter-volts-text" id="flowBoard_inverter-volts">0.0 V</div> <div class="inverter-amps-text" id="flowBoard_inverter-amps">0.0 A</div> <div class="inverter-hz-text" id="flowBoard_inverter-hz">0 Hz</div>
                    </div>
                    <!-- Battery -->
                   <div class="battery-container">
                        <div class="battery-icon"> <svg class="battery-icon-svg" viewBox="0 0 40 98" preserveAspectRatio="xMidYMid meet"> <defs> <clipPath id="flowBoard_batteryLiquidClip"> <rect id="flowBoard_batteryClipRect" x="5" y="80" width="30" height="0" /> </clipPath> </defs> <rect x="2" y="5" width="36" height="95" rx="3" ry="3" class="battery-case"/> <rect x="10" y="-4" width="20" height="10" rx="1" ry="1" class="battery-terminal"/> <rect id="flowBoard_battery-fill-level" x="5" y="80" width="30" height="0" class="battery-fill"/> <g id="flowBoard_batteryBubblesGroup" clip-path="url(#flowBoard_batteryLiquidClip)"></g> </svg> </div>
                        <div class="battery-soc-text" id="flowBoard_battery-soc-percent"> <span class="value-text">0%</span> </div>
                        <div class="battery-kwh-up-text" id="flowBoard_battery-kwh-up">↑0 kWh</div> <div class="battery-kwh-down-text" id="flowBoard_battery-kwh-down">↓0 kWh</div>
                        <div class="battery-details-box" id="flowBoard_battery-details-box"> <div class="battery-volts-text" id="flowBoard_battery-volts">0.0 V</div> <div class="battery-amps-text" id="flowBoard_battery-amps">0.0 A</div> <div class="battery-status-text" id="flowBoard_battery-status">Idle</div> </div>
						<div class="bms-plugin-fault-indicator" id="flowBoard_bms-plugin-status-light" title="BMS Plugin Status"></div>
                        <div class="battery-runtime-text" id="flowBoard_battery-runtime"> <span class="value-text">N/A</span> </div>
                    </div>
                    <div class="battery-power-container"> <div class="battery-power-border" id="flowBoard_battery-power-border"></div> <div class="battery-power-text" id="flowBoard_battery-power-text">0 W</div> </div>
                    <!-- Load -->
                    <div class="load-container">
                        <div class="load-house-icon"> <svg viewBox="0 0 100 100" fill="none" stroke-width="2"> <defs> <linearGradient id="windowGradient_themed_light" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" class="load-icon-window-grad-stop1" /><stop offset="100%" class="load-icon-window-grad-stop2" /></linearGradient> <linearGradient id="windowGradient_themed_dark" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" class="load-icon-window-grad-stop1" /><stop offset="100%" class="load-icon-window-grad-stop2" /></linearGradient> </defs> <polygon points="20,40 50,10 80,40" class="load-icon-roof" /><polygon points="20,40 20,90 50,90 50,40" class="load-icon-wall-main" /><polygon points="50,40 50,90 80,90 80,40" class="load-icon-wall-side" /><rect x="65" y="25" width="5" height="15" class="load-icon-chimney" /> <rect x="30" y="50" width="10" height="10" class="load-icon-window-fill" /><rect x="55" y="50" width="15" height="10" class="load-icon-window-fill" /><rect x="30" y="20" width="10" height="10" class="load-icon-window-fill" /> <rect class="glow" x="31" y="51" width="8" height="8" /><rect class="glow" x="56" y="51" width="13" height="8" /><rect class="glow" x="31" y="21" width="8" height="8" /> <rect class="shutter" x="30" y="50" width="10" height="10" /><rect class="shutter" x="55" y="50" width="15" height="10" /><rect class="shutter" x="30" y="20" width="10" height="10" /> <rect x="30" y="70" width="10" height="20" class="load-icon-door" /> <style>.glow { animation: flowBoard_innerGlow 2s ease-in-out infinite; } .shutter { animation: flowBoard_openShutter 2s ease-in-out infinite; } @keyframes flowBoard_innerGlow { 0%, 100% { opacity: 0; } 50% { opacity: 1; } } @keyframes flowBoard_openShutter { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }</style> </svg> </div>
                        <div class="load-total-text" id="flowBoard_load-total-kwh"> <span class="value-text">0.0 kWh</span> </div>
						<span class="load-production-display-title-box"></span> <span class="load-production-display-title">PRODUCTION</span>
                        <div class="load-production-display-area"> <div class="production-column" id="flowBoard_prod-to-solar-col"><div class="production-text-details"><span class="production-icon">☀</span><span class="production-name">Solar Self-Use</span><span class="production-power">(0.0 kWh)</span><span class="production-percentage">0%</span></div></div> <div class="production-column" id="flowBoard_prod-to-battery-col"><div class="production-text-details"><span class="production-icon">🔋</span><span class="production-name">Battery Charge</span><span class="production-power">(0.0 kWh)</span><span class="production-percentage">0%</span></div></div> <div class="production-column" id="flowBoard_prod-to-grid-col"><div class="production-text-details"><span class="production-icon">⚡</span><span class="production-name">Grid Export</span><span class="production-power">(0.0 kWh)</span><span class="production-percentage">0%</span></div></div> </div>
						<span class="load-source-display-title-box"></span> <span class="load-source-display-title">LOAD CONSUMPTION</span>
                        <div class="load-source-display-area"> <div class="source-column" id="flowBoard_load-from-solar-col"><div class="source-text-details"><span class="source-icon">☀</span><span class="source-name">Solar Self-Use</span><span class="source-power">(0.0 kWh)</span><span class="source-percentage">0%</span></div></div> <div class="source-column" id="flowBoard_load-from-battery-col"><div class="source-text-details"><span class="source-icon">🔋</span><span class="source-name">Battery Discharge</span><span class="source-power">(0.0 kWh)</span><span class="source-percentage">0%</span></div></div> <div class="source-column" id="flowBoard_load-from-grid-col"><div class="source-text-details"><span class="source-icon">⚡</span><span class="source-name">Grid Import</span><span class="source-power">(0.0 kWh)</span><span class="source-percentage">0%</span></div></div> </div>
                    </div>
                    <div class="load-power-container"> <div class="load-power-border"></div> <div class="load-power-text" id="flowBoard_load-power-text">0 W</div> </div>
                    <!-- Flow Lines & Indicators -->
					<div class="flow-line-container pv1-to-pvtotal-line pv-string-line" style="display: none; left: 516px; top: 155.5px; width: 65px; height: 102px;"><svg viewBox="0 0 65 102"><path id="flowBoard_pv1-to-pvtotal-path" d="M0,0 L35,0 A15,15 0 0 1 50,15 L50,87 A15,15 0 0 0 65,102"/></svg></div>
					<div class="flow-line-container pv3-to-pvtotal-line pv-string-line" style="display: none; left: 516px; top: 257.5px; width: 65px; height: 5px;"><svg viewBox="0 0 65 5"><path id="flowBoard_pv3-to-pvtotal-path" d="M0,1 L65,0"/></svg></div>
					<div class="flow-line-container pv2-to-pvtotal-line pv-string-line" style="display: none; left: 794px; top: 155.5px; width: 63px; height: 102px;"><svg viewBox="0 0 63 102"><path id="flowBoard_pv2-to-pvtotal-path" d="M63,0 L28,0 A15,15 0 0 0 13,15 L13,87 A15,15 0 0 1 0,102"/></svg></div>
					<div class="flow-line-container pv4-to-pvtotal-line pv-string-line" style="display: none; left: 794px; top: 257.5px; width: 63px; height: 5px;"><svg viewBox="0 0 63 5"><path id="flowBoard_pv4-to-pvtotal-path" d="M63,1 L0,0"/></svg></div>					
                    <div class="flow-line-container pvtotal-to-inverter-line"><svg viewBox="0 0 20 193"><path id="flowBoard_pv-to-inverter-path" d="M10,0 L10,113"/></svg></div>
                    <div class="flow-line-container grid-to-inverter-line" id="flowBoard_grid-to-inverter-line-container"><svg viewBox="0 0 107 20"><path id="flowBoard_grid-to-inverter-path" d="M0,10 L107,10"/></svg></div>
					<div class="flow-line-container grid-to-inverter-line2" id="flowBoard_grid-to-inverter-line-container2"><svg viewBox="0 0 107 20"><path id="flowBoard_grid-to-inverter-path2" d="M0,10 L107,10"/></svg></div>
                    <div class="flow-line-container battery-to-inverter-line" id="flowBoard_battery-to-inverter-line-container"><svg viewBox="0 0 118 20"><path id="flowBoard_battery-to-inverter-path" d="M0,10 L118,10"/></svg></div>
					<div class="flow-line-container battery-to-inverter-line2" id="flowBoard_battery-to-inverter-line-container2"><svg viewBox="0 0 118 20"><path id="flowBoard_battery-to-inverter-path2" d="M0,10 L118,10"/></svg></div>
                    <div class="flow-line-container inverter-to-load-line"><svg viewBox="0 0 20 112"><path id="flowBoard_inverter-to-load-path" d="M10,0 L10,112"/></svg></div>
                    <div class="flow-indicator" id="flowBoard_pv-flow-indicator" style="background-color: var(--flow-text-pv);"></div>
                    <div class="flow-indicator" id="flowBoard_grid-flow-indicator" style="background-color: var(--flow-text-grid-import);"></div> 
					<div class="flow-indicator" id="flowBoard_grid-flow-indicator2" style="background-color: var(--flow-text-grid-import);"></div> 
                    <div class="flow-indicator" id="flowBoard_battery-flow-indicator" style="background-color: var(--flow-text-battery);"></div>
					<div class="flow-indicator" id="flowBoard_battery-flow-indicator2" style="background-color: var(--flow-text-battery);"></div>
                    <div class="flow-indicator" id="flowBoard_load-flow-indicator" style="background-color: var(--flow-text-load);"></div>
                    <div class="flow-indicator" id="flowBoard_pv1-to-total-flow-indicator" style="background-color: var(--flow-text-pv);"></div>
                    <div class="flow-indicator" id="flowBoard_pv2-to-total-flow-indicator" style="background-color: var(--flow-text-pv);"></div>
                    <div class="flow-indicator" id="flowBoard_pv3-to-total-flow-indicator" style="background-color: var(--flow-text-pv);"></div>
                    <div class="flow-indicator" id="flowBoard_pv4-to-total-flow-indicator" style="background-color: var(--flow-text-pv);"></div>
                </div>
            </div>
		</div> 
         <div class="right-column-container">
            <div class="section" id="top-tab-section">
                <!-- 1. The Header with tab buttons -->
                <div class="tab-header">
                    <div class="tab-buttons">
                        <button class="tab-link active" data-tab="power-metrics-tab">
                            <span class="section-header-title">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
                                Power Metrics
                            </span>
                        </button>
                        <button class="tab-link" data-tab="weather-tab" id="weatherViewTab" style="display: none;">
                            <span class="section-header-title">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M22 17a5 5 0 0 0-3-8h-2.26a8 8 0 0 0-15.48 0H1.5a4.5 4.5 0 0 0 0 9h21z" />
                                </svg>
                                Weather
                            </span>
                        </button>
                    </div>
                    <div class="section-header-controls" id="powerMetricsControls">
                        <button id="refreshPowerChartBtn" class="tiny-btn tiny-refresh-btn" title="Refresh Power Chart">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>
                        </button>
                        <button id="exportPowerChartBtn" class="tiny-btn" title="Export Power Data">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                        </button>
                    </div>
                    <div class="section-header-controls" id="weatherControls" style="display: none;">
                    </div>
                </div>
                <!-- 2. The Content Area Wrapper -->
                <div class="tab-content-area">
                    <div id="power-metrics-tab" class="tab-content active">
                        <div class="chart-container">
                            <canvas id="powerChart"></canvas>
                        </div>
                    </div>
                    <div id="weather-tab" class="tab-content">
                        <div class="weather-card">
                            <!-- Left Panel -->
                            <div class="weather-info">
								<div class="weather-header">
                                    <div class="datetime" id="datetime">Loading...</div>
                                    <div class="location" id="location"></div>
                                </div>                                <div class="current-weather-main">
                                    <div class="weather-icon-container">
                                        <svg id="main-weather-icon-svg"><use id="main-weather-icon" xlink:href="#cloudy"></use></svg>
                                    </div>
                                    <div class="temp" id="temperature">--°C</div>
                                </div>
                                <div class="weather-type" id="weather-type">--</div>
                                <div class="weather-details-grid">
                                    <div class="detail-item"><svg class="icon"><use xlink:href="#icon-precipitation"></use></svg><span id="precipitation">-- %</span></div>
                                    <div class="detail-item right-icon"><span id="wind">-- km/h</span><svg class="icon"><use xlink:href="#icon-wind"></use></svg></div>
                                    <div class="detail-item"><svg class="icon"><use xlink:href="#cloudy"></use></svg><span id="cloud-cover">-- %</span></div>
                                    <div class="detail-item right-icon"><span id="visibility">-- km</span><svg class="icon"><use xlink:href="#icon-visibility"></use></svg></div>
                                    <div class="detail-item"><svg class="icon"><use xlink:href="#icon-sunrise"></use></svg><span id="sunrise">--:-- AM</span></div>
                                    <div class="detail-item right-icon"><span id="sunset">--:-- PM</span><svg class="icon" style="transform: rotate(180deg);"><use xlink:href="#icon-sunrise"></use></svg></div>
                                </div>
                                <div class="daily-forecast" id="daily-forecast-container"></div>
                            </div>
                            <!-- Right Panel: Map -->
                            <div class="weather-map-container">
                                <div id="map"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
			<div class="section" id="tabbed-card-section">
				<!-- 1. The Header with buttons and controls -->
				<div class="tab-header">
					<div class="tab-buttons">
						<button class="tab-link" data-tab="bms-tab" id="bmsViewTab" style="display: none;">
							<span class="section-header-title">
								<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<path d="M4 7h10v10H4z"/><path d="M8 7V5h2v2"/><path d="M14 11h6"/><path d="M17 8v6"/><path d="M20 11h2v2h-2zM14 15h2v2h-2z"/>
								</svg>
								BMS
							</span>
						</button>
						<button class="tab-link active" data-tab="history-tab">
							<span class="section-header-title">
								<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
									<path d="M12 20V10"/><path d="M18 20V4"/><path d="M6 20V16"/>
								</svg> 
								History
							</span>
						</button>
                        <button class="tab-link" data-tab="hourly-tab">
                            <span class="section-header-title">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M12 2v2"/><path d="M12 20v2"/><path d="M5 12H3"/><path d="M21 12h-2"/><path d="m17 7-1.4-1.4"/><path d="m8.4 15.6 1.4 1.4"/><path d="m17 17-1.4 1.4"/><path d="m8.4 8.4-1.4-1.4"/>
                                </svg> 
                                Hourly
                            </span>
                        </button>
					</div>
					<div class="section-header-controls" id="historyControls" style="display: none;">
						<select id="historyPeriodSelect" title="Select history period">
							<option value="last_7_days" selected>Last 7 Days</option>
							<option value="current_month_daily">Current Month</option>
							<option value="yearly_by_month">Current Year (Monthly)</option>
							<option value="yearly_summary">All Time (Yearly)</option>
						</select>
						<button id="refreshHistoryChartBtn" class="tiny-btn tiny-refresh-btn" title="Refresh History Chart">
							<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>
						</button>
						<button id="exportHistoryChartBtn" class="tiny-btn" title="Export History Data">
							<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
						</button>
					</div>
                    <div class="section-header-controls" id="hourlyControls" style="display: none;">
                        <input type="date" id="hourlyDateSelect" title="Select date for hourly summary">
                        <button id="refreshHourlyChartBtn" class="tiny-btn tiny-refresh-btn" title="Refresh Hourly Chart">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>
                        </button>
                        <button id="exportHourlyChartBtn" class="tiny-btn" title="Export Hourly Data">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                        </button>
                    </div>
				</div>

				<!-- 2. The Content Area Wrapper (INSIDE the section) -->
				<div class="tab-content-area">
					<div id="bms-tab" class="tab-content">
						<iframe id="bms-iframe" src="/bms" style="width: 100%; height: 100%; border: none;"></iframe>
					</div>
					<div id="history-tab" class="tab-content active">
						<div class="chart-container">
							<canvas id="historicalEnergyChart"></canvas>
						</div>
					</div>
                    <div id="hourly-tab" class="tab-content">
                        <div class="chart-container">
                            <canvas id="hourlyEnergyChart"></canvas>
                        </div>
                    </div>
				</div>
			</div>         
        </div> 
    </div> 
	<div id="disconnectOverlay"></div>
	<div id="disconnectPopup">
		<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>
		<span id="disconnectPopupMessage">Disconnected. Attempting to reconnect...</span>
		<button id="manualReconnectBtn" class="manual-reconnect-btn">
			<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
				<polyline points="23 4 23 10 17 10"></polyline>
				<polyline points="1 20 1 14 7 14"></polyline>
				<path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
			</svg>
			Reconnect Now
		</button>
	</div>
	<footer>
		<div class="footer-content">
			<span class="footer-left"></span>
			<span class="footer-center">Solar Dashboard by <a href="https://github.com/jcvsite" target="_blank">JCV</a>
			<span id="updateStatusMessage"></span>
			</span>
			<span id="lastUpdate">Last Update: Loading...</span>
			<span id="connectionStatus" class="connection-status">●</span>
		</div>
	</footer>

    <script type="module" src="/static/js/app.js"></script>
</body>
</html>